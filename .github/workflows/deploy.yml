name: Deploy TiraDï¿½ï¿½vidas

on:  
  push: 
    branches: 
      - main      # Deploy para produÃ§Ã£o
      - develop   # Deploy para homologaÃ§Ã£o

jobs: 
  deploy:  
    runs-on:  self-hosted
    
    steps: 
      - name: Checkout cÃ³digo
        uses:  actions/checkout@v4

      - name:  Deploy para ProduÃ§Ã£o
        if:  github.ref == 'refs/heads/main'
        run:  |
          cd /opt/apps/tiraduvidas/producao/tira-duvidas-project/
          
          echo "ðŸ“¥ Atualizando cÃ³digo..."
          git pull origin main
          
          echo "ðŸ”¨ Rebuild e restart dos containers..."
          sudo docker compose -p tiraduvidas-prod -f docker-compose.prod.yml up -d --build
          
          echo "ðŸ§¹ Limpando imagens antigas..."
          sudo docker image prune -f
          
          echo "âœ… Deploy de produÃ§Ã£o concluÃ­do!"

      - name: Deploy para HomologaÃ§Ã£o
        if: github. ref == 'refs/heads/develop'
        run:  |
          cd /opt/apps/tiraduvidas/homologacao/tira-duvidas-project/
          
          echo "ðŸ“¥ Atualizando cÃ³digo..."
          git pull origin develop
          
          echo "ðŸ”¨ Rebuild e restart dos containers..."
          sudo docker compose -p tiraduvidas-homolog -f docker-compose. homolog.yml up -d --build
          
          echo "ðŸ§¹ Limpando imagens antigas..."
          sudo docker image prune -f
          
          echo "âœ… Deploy de homologaÃ§Ã£o concluÃ­do!"